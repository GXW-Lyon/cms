webpackJsonp([37],{"6AGL":function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"info_flow_content customerAccountBill",on:{click:t.bodyEvent}},[a("div",{staticClass:"menuNav"},[a("p",[a("i",{staticClass:"nav_index"}),t._l(t.menu_nav,function(e,s){return a("span",{key:s},[a("i",{staticClass:"el-icon-arrow-right"}),a("em",[t._v(t._s(e))])])})],2)]),t._v(" "),a("div",{staticClass:"info_ad_search"},[a("div",{staticClass:"info_a_s_content"},[a("div",{staticClass:"dateSelect"},[a("div",{staticClass:"block"},[a("span",{staticClass:"demonstration"},[t._v("选择日期")]),t._v(" "),a("el-date-picker",{attrs:{type:"daterange",align:"right",placeholder:"选择日期范围",format:"yyyy / MM / dd","picker-options":t.pickerOptions2},on:{change:t.dateChange},model:{value:t.dateValue,callback:function(e){t.dateValue=e},expression:"dateValue"}})],1),t._v(" "),a("el-select",{staticClass:"con_select unBorderRadius",attrs:{placeholder:t.customer_items.placeHolder,filterable:"",clearable:""},on:{change:t.proInfo},model:{value:t.customer_items.model_value,callback:function(e){t.$set(t.customer_items,"model_value",e)},expression:"customer_items.model_value"}},t._l(t.customer_items.options,function(t){return a("el-option",{key:t.id,attrs:{label:t.customerName,value:t.id}})})),t._v(" "),a("el-select",{staticClass:"con_select unBorderRadius",attrs:{placeholder:t.platform_items.placeHolder,clearable:""},on:{change:t.proInfo},model:{value:t.platform_items.model_value,callback:function(e){t.$set(t.platform_items,"model_value",e)},expression:"platform_items.model_value"}},t._l(t.platform_items.options,function(t){return a("el-option",{key:t.platformId,attrs:{label:t.platformName,value:t.platformId}})})),t._v(" "),a("el-select",{staticClass:"con_select unBorderRadius",attrs:{placeholder:t.pro_items.placeHolder,clearable:"",filterable:""},model:{value:t.pro_items.model_value,callback:function(e){t.$set(t.pro_items,"model_value",e)},expression:"pro_items.model_value"}},t._l(t.pro_items.options,function(t){return a("el-option",{key:t.productId,attrs:{label:t.productName,value:t.productId}})})),t._v(" "),a("el-select",{staticClass:"con_select unBorderRadius",attrs:{placeholder:t.status_items.placeHolder,clearable:""},model:{value:t.status_items.model_value,callback:function(e){t.$set(t.status_items,"model_value",e)},expression:"status_items.model_value"}},t._l(t.status_items.options,function(t){return a("el-option",{key:t.id,attrs:{label:t.val,value:t.id}})})),t._v(" "),a("el-button",{staticClass:"page_d_s_button",staticStyle:{"margin-left":"5px"},on:{click:function(e){return e.stopPropagation(),t.importData(e)}}},[t._v("导出当前数据\n                    ")]),t._v(" "),a("el-button",{staticClass:"page_d_s_button",on:{click:function(e){return e.stopPropagation(),t.pageInfo(e)}}},[t._v("查询")])],1),t._v(" "),a("div",{staticClass:"realTimeCitySearch"},[t._l(t.select_itemss,function(e,s){return a("el-select",{key:s,staticClass:"con_select",attrs:{placeholder:e.placeHolder},on:{change:function(t){}},model:{value:e.model_value,callback:function(a){t.$set(e,"model_value",a)},expression:"c.model_value"}},t._l(e.options,function(t){return a("el-option",{key:t.id,attrs:{label:t.val,value:t.id}})}))}),t._v(" "),a("el-button",{staticClass:"page_d_s_button",staticStyle:{float:"right"},on:{click:t.noAccountBtn}},[t._v("\n                        不予结算\n                    ")]),t._v(" "),a("el-button",{staticClass:"page_d_s_button",staticStyle:{float:"right"},on:{click:t.createBill}},[t._v("\n                        对账无误，生成结算单\n                    ")]),t._v(" "),a("el-button",{staticClass:"page_d_s_button",staticStyle:{float:"right"},attrs:{disabled:t.oneKeyStatus},on:{click:t.oneKeyCreateBill}},[t._v("\n                        一键生成结算单\n                    ")])],2)])]),t._v(" "),a("div",{staticClass:"info_ad_table"},[a("div",{staticClass:"page_d_title"},[a("i",{staticStyle:{visibility:"hidden"}}),a("span"),t._v(" "),a("div",{staticClass:"tableVisibleMenu"},[a("p",{staticClass:"visibleMenuBut",on:{click:function(e){return e.stopPropagation(),t.changeCheckStatus(e)}}}),t._v(" "),t.visibleMenuSelectStatus?a("div",{staticClass:"visibleMenuSelect",on:{click:function(t){t.stopPropagation()}}},[a("el-checkbox-group",{attrs:{min:1},on:{change:t.checkedChange},model:{value:t.checkedCities,callback:function(e){t.checkedCities=e},expression:"checkedCities"}},t._l(t.cities,function(e){return a("el-checkbox",{key:e,attrs:{label:e}},[t._v(t._s(e))])}))],1):t._e()])]),t._v(" "),a("div",{staticClass:"tableDetail"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{"element-loading-text":"拼命加载中",data:t.tableData,border:"",stripe:""}},[t._l(t.table_column,function(e,s){return e.visible?a("el-table-column",{key:s,attrs:{fixed:e.fixed,sortable:e.sortable,formatter:e.format,prop:e.prop,label:e.label,"class-name":e.prop.split(".")[1],"min-width":e.minwidth,width:"auto"}}):t._e()}),t._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"有效核算",width:"100","class-name":"exitBut"},scopedSlots:t._u([{key:"default",fn:function(e){return["button"==e.row.validStatus?a("span",{staticClass:"r_span",on:{click:t.checkAllEvent}},[t._v(t._s(t.checkAll?"全选":"取消全选"))]):t._e(),t._v(" "),"未结算"==e.row.settleStatus?a("el-checkbox",{model:{value:e.row.validStatus,callback:function(a){t.$set(e.row,"validStatus",a)},expression:"scope.row.validStatus"}}):t._e()]}}])})],2)],1)]),t._v(" "),a("div",{staticClass:"con_pager"},[a("div",{staticClass:"block"},[a("el-pagination",{attrs:{"current-page":t.page.currentPage,"page-sizes":t.page.sizes,"page-size":t.page.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.page.count},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.$set(t.page,"currentPage",e)}}})],1)]),t._v(" "),t.billStatus?a("div",{staticClass:"bill",staticStyle:{height:"auto"},on:{click:function(t){t.stopPropagation()}}},[a("div",{staticClass:"bill_title"},[a("span",[t._v("对账单预览")]),t._v(" "),a("button",{on:{click:function(e){return e.stopPropagation(),t.exitBill(e)}}},[t._v("×")])]),t._v(" "),a("div",{staticClass:"bill_table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableDataBill,border:"",stripe:""}},t._l(t.table_column_bill_title,function(e,s){return e.visible?a("el-table-column",{key:s,attrs:{fixed:e.fixed,sortable:e.sortable,formatter:e.format,prop:e.prop,label:e.label,width:""}}):t._e()})),t._v(" "),a("div",{staticStyle:{"text-align":"center",height:"200px","line-height":"200px"}},[a("el-button",{staticClass:"formalBtn",attrs:{type:"primary"},on:{click:t.createCusBill}},[t._v("确认")]),t._v(" "),a("el-button",{staticClass:"formalBtn",attrs:{type:"primary"},on:{click:t.exitBill}},[t._v("返回")])],1)],1)]):t._e()])])},i=[],l={render:s,staticRenderFns:i};e.a=l},EifE:function(t,e,a){var s=a("gs55");"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);a("FIqI")("d5c20d92",s,!0,{})},Ek38:function(t,e,a){"use strict";function s(t){a("EifE")}Object.defineProperty(e,"__esModule",{value:!0});var i=a("glra"),l=a("6AGL"),o=a("vSla"),n=s,r=o(i.a,l.a,!1,n,null,null);e.default=r.exports},glra:function(t,e,a){"use strict";var s=a("HzJ8"),i=a.n(s);e.a={data:function(){return{checked:!0,loading:!1,billStatus:!1,visibleMenuSelectStatus:!1,checkAll:!0,checkedCities:["日期","客户名称","产品名称","账号","平台名称","消耗金额","折后金额","结算状态"],cities:["日期","客户名称","产品名称","账号","平台名称","消耗金额","折后金额","结算状态"],citiesFilterVal:["date","custmoerName","productName","accountName","platformName","consumeAmount","settleDiscountAmount","settleStatus"],table_column:[{fixed:!0,prop:"date",label:"日期",sortable:!0,visible:!0,minwidth:100},{fixed:!1,prop:"custmoerName",label:"客户名称",sortable:!1,visible:!0,minwidth:250},{fixed:!1,prop:"productName",label:"产品名称",sortable:!1,visible:!0},{fixed:!1,prop:"accountName",label:"账号",sortable:!1,visible:!0,minwidth:140},{fixed:!1,prop:"platformName",label:"平台名称",sortable:!1,visible:!0,minwidth:100},{fixed:!1,prop:"consumeAmount",label:"消耗金额",sortable:!1,visible:!0},{fixed:!1,prop:"settleDiscountAmount",label:"折后金额",sortable:!1,visible:!0,minwidth:110},{fixed:!1,prop:"rebate",label:"折扣",sortable:!1,visible:!0},{fixed:!1,prop:"settleStatus",label:"结算状态",sortable:!1,visible:!0,minwidth:80}],table_column_bill_title:[{fixed:!1,prop:"accountCycle",label:"账目周期",sortable:!1,visible:!0},{fixed:!1,prop:"custmoerName",label:"客户名称",sortable:!1,visible:!0},{fixed:!1,prop:"consumeAmount",label:"消耗金额",sortable:!1,visible:!0},{fixed:!1,prop:"settleDiscountAmount",label:"折后金额",sortable:!1,visible:!0}],page:{sizes:[10,20,50,100,200,500],offset:1,limit:10,count:0,currentPage:1},pickerOptions2:{shortcuts:[{text:"本月",onClick:function(t){var e=new Date,a=new Date;a.setDate(1),t.$emit("pick",[a,e])}},{text:"上个月",onClick:function(t){var e=new Date,a=e.getFullYear(),s=e.getMonth(),i=new Date(a,s-1,1),l=new Date(a,s,0).getDate(),o=new Date(a,s-1,l);t.$emit("pick",[i,o])}},{text:"前三个月",onClick:function(t){var e=new Date,a=e.getFullYear(),s=e.getMonth(),i=new Date(a,s-3,1),l=new Date(a,s,0).getDate(),o=new Date(a,s-1,l);t.$emit("pick",[i,o])}}]},menu_nav:["信息流数据管理","客户对账"],customer_items:{model_value:"",placeHolder:"客户",options:[]},pro_items:{model_value:"",placeHolder:"产品",options:[]},platform_items:{model_value:"",placeHolder:"平台",options:[]},status_items:{model_value:"",placeHolder:"状态",options:[{id:0,val:"未结算"},{id:1,val:"已结算"},{id:2,val:"已核算"},{id:3,val:"不结算"},{id:4,val:"已抵扣"}]},select_itemss:[{model_value:"",placeHolder:"结算主体",options:[{id:"Y1",val:"深圳康远互动科技有限公司"},{id:"Y2",val:"霍尔果斯康远互动网络科技有限公司"},{id:"Y3",val:"上海贝玩网络科技有限公司"},{id:"Y4",val:"深圳自由泰格互动科技有限公司"}]},{model_value:"",placeHolder:"结账模式",options:[{id:"2",val:"正常结算"},{id:"1",val:"预收抵扣"},{id:"3",val:"充值结算"}]}],tableData:[],tableDataBill:[],dateValue:"",params:{type:"",val:"",date:""},idList:[],oneKeyStatus:!0,oneKeyBtnStatus:!1,oneKey:"",isFirstEnter:!1}},activated:function(){this.$route.meta.isBack&&!this.isFirstEnter||(this.customer(),this.platform()),this.$route.meta.isBack=!1,this.isFirstEnter=!1},created:function(){this.isFirstEnter=!0},methods:{customer:function(){var t=this;this.$http({method:"get",url:this.apiUrl.fdpCusGetCustomerList}).then(function(e){if(console.log(e),200==e.status){var a=e.data;t.customer_items.options=a}}).catch(function(t){console.log(t)})},proInfo:function(){var t=this;if(this.pro_items.model_value="",this.pro_items.options=[],!this.customer_items.model_value||!this.platform_items.model_value)return!1;this.$http({method:"get",url:this.apiUrl.fdpProListname,params:{customerId:this.customer_items.model_value||-1,platformId:this.platform_items.model_value||-1}}).then(function(e){if(console.log(e),200==e.status){var a=e.data;t.pro_items.options=a}}).catch(function(t){console.log(t)})},platform:function(){var t=this;this.$http({method:"get",url:this.apiUrl.fdpPlaGetPlatformList}).then(function(e){if(200==e.status){var a=e.data;t.platform_items.options=a}}).catch(function(t){console.log(t)})},pageInfo:function(){var t=this;return""==this.dateValue||void 0===this.dateValue||null==this.dateValue[0]?(this.$message({type:"info",message:"请选择日期"}),!1):""==this.customer_items.model_value?(this.$message({type:"info",message:"请选择客户"}),!1):""==this.platform_items.model_value?(this.$message({type:"info",message:"请选择平台"}),!1):""==this.pro_items.model_value?(this.$message({type:"info",message:"请选择产品"}),!1):(this.loading=!0,void this.$http({method:"get",url:this.apiUrl.fdpCusFilter,params:{curPage:this.page.offset,limit:this.page.limit,sDateTime:this.params.date,customerId:this.customer_items.model_value,productId:this.pro_items.model_value,platformId:this.platform_items.model_value,status:this.status_items.model_value}}).then(function(e){if(e.status=200){var a=!0,s=!1,l=void 0;try{for(var o,n=i()(e.data.list);!(a=(o=n.next()).done);a=!0){var r=o.value;!function(e){e.settleStatus=t.status_items.options.find(function(t){return t.id==e.settleStatus}).val||"-","未结算"==e.settleStatus&&(e.validStatus=!1)}(r)}}catch(t){s=!0,l=t}finally{try{!a&&n.return&&n.return()}finally{if(s)throw l}}t.checkAll=!0,e.data.list.length>0&&t.$http({method:"get",url:t.apiUrl.fdpCusFilterSum,params:{sDateTime:t.params.date,customerId:t.customer_items.model_value,productId:t.pro_items.model_value,platformId:t.platform_items.model_value,status:t.status_items.model_value}}).then(function(a){t.loading=!1,(a.status=200)&&(t.page.count=a.data.totalNums,t.oneKey=a.data.ids,t.oneKey?t.oneKeyStatus=!1:t.oneKeyStatus=!0,e.data.list.unshift({date:"总计",settleDiscountAmount:a.data.totalDstConsum,consumeAmount:a.data.totalConsume,validStatus:"button"}),t.tableData=e.data.list)}).catch(function(t){})}}).catch(function(e){t.loading=!1}))},createCusBill:function(){var t=this;this.loading=!0,this.$http({method:"get",url:this.apiUrl.fdpCusGenerate,params:{entity:this.select_itemss[0].model_value,settleMode:this.select_itemss[1].model_value,Ids:this.oneKeyBtnStatus?this.oneKey:this.idList.join(","),amounts:this.tableDataBill[0].settleDiscountAmount||0}}).then(function(e){if(e.status=200){t.loading=!1;var a=e.data;1==a.status?(t.$message({type:"success",message:"生成成功!"}),t.billStatus=!1,t.pageInfo()):t.$message({type:"error",message:a.msg})}}).catch(function(e){t.loading=!1,t.$message({type:"error",message:"生成对账单失败"})})},preCusBill:function(){var t=this;this.loading=!0,this.$http({method:"get",url:this.apiUrl.fdpCusPreview,params:{entity:this.select_itemss[0].model_value,settleMode:this.select_itemss[1].model_value,Ids:this.oneKeyBtnStatus?this.oneKey:this.idList.join(",")}}).then(function(e){if(e.status=200){t.loading=!1;var a=e.data;1==a.status?(t.tableDataBill=[{accountCycle:a.accountCycle,consumeAmount:a.consumeAmount,custmoerName:a.custmoerName,settleDiscountAmount:a.settleDiscountAmount}],t.billStatus=!0):t.$message({type:"error",message:a.msg})}}).catch(function(e){t.loading=!1,t.$message({type:"error",message:"预览对账单失败"})})},handleCurrentChange:function(t){this.page.offset=t,this.pageInfo()},handleSizeChange:function(t){this.page.limit=t,this.pageInfo()},checkedChange:function(){var t=!0,e=!1,a=void 0;try{for(var s,l=i()(this.table_column);!(t=(s=l.next()).done);t=!0){var o=s.value,n=this.checkedCities.indexOf(o.label);o.visible=n>=0}}catch(t){e=!0,a=t}finally{try{!t&&l.return&&l.return()}finally{if(e)throw a}}},changeCheckStatus:function(){this.visibleMenuSelectStatus=!this.visibleMenuSelectStatus},bodyEvent:function(){this.visibleMenuSelectStatus=!1},changeInput:function(t){return t},dateChange:function(){""!=this.dateValue&&void 0!==this.dateValue&&null!=this.dateValue[0]&&null!=this.dateValue[1]?this.params.date=this.formatDateTime(this.dateValue[0],"y/m/d")+"-"+this.formatDateTime(this.dateValue[1],"y/m/d"):this.params.date=""},checkAllEvent:function(){var t=!0,e=!0,a=!1,s=void 0;try{for(var l,o=i()(this.tableData);!(e=(l=o.next()).done);e=!0){var n=l.value;"button"!=n.validStatus&&"未结算"==n.settleStatus&&(n.validStatus=this.checkAll,t=!1)}}catch(t){a=!0,s=t}finally{try{!e&&o.return&&o.return()}finally{if(a)throw s}}if(t)return!1;this.checkAll=!this.checkAll},createBill:function(){if(""==this.select_itemss[0].model_value)return this.$message({type:"info",message:"请选择结算主体"}),!1;if(""==this.select_itemss[1].model_value)return this.$message({type:"info",message:"请选择结账模式"}),!1;this.idList=[];var t=!0,e=!1,a=void 0;try{for(var s,l=i()(this.tableData);!(t=(s=l.next()).done);t=!0){var o=s.value;o.validStatus&&"button"!=o.validStatus&&this.idList.push(o.id)}}catch(t){e=!0,a=t}finally{try{!t&&l.return&&l.return()}finally{if(e)throw a}}0==this.idList.length?this.$message({type:"info",message:"请选择账单"}):(this.oneKeyBtnStatus=!1,this.preCusBill())},oneKeyCreateBill:function(){return this.loading?(this.$message({type:"info",message:"正在生成结算单，请稍后再试"}),!1):""==this.select_itemss[0].model_value?(this.$message({type:"info",message:"请选择结算主体"}),!1):""==this.select_itemss[1].model_value?(this.$message({type:"info",message:"请选择结账模式"}),!1):(this.oneKeyBtnStatus=!0,void this.preCusBill())},noAccountBtn:function(){this.idList=[];var t=!0,e=!1,a=void 0;try{for(var s,l=i()(this.tableData);!(t=(s=l.next()).done);t=!0){var o=s.value;o.validStatus&&"button"!=o.validStatus&&this.idList.push(o.id)}}catch(t){e=!0,a=t}finally{try{!t&&l.return&&l.return()}finally{if(e)throw a}}0==this.idList.length?this.$message({type:"info",message:"请选择账单"}):this.noAccount()},noAccount:function(){var t=this;this.$http({method:"get",url:this.apiUrl.fdpCusUpdate,params:{Ids:this.idList.join(",")}}).then(function(e){if(e.status=200){var a=e.data;1==a.status?(t.$message({type:"success",message:"操作成功!"}),t.pageInfo()):t.$message({type:"error",message:a.msg})}}).catch(function(e){t.$message({type:"error",message:"操作失败"})})},importData:function(){if(0==this.tableData.length)return this.$message({type:"info",message:"请查询数据"}),!1;var t=this.cities,e=this.citiesFilterVal,a=this.tableData,s=[this.params.date,this.customer_items.model_value,this.pro_items.model_value,this.platform_items.model_value,this.status_items.model_value,"客户对账"].join("_");this.handleDownload(t,e,a,s)},exitBill:function(){this.billStatus=!1}}}},gs55:function(t,e,a){e=t.exports=a("UTlt")(!0),e.push([t.i,"","",{version:3,sources:[],names:[],mappings:"",file:"customerAccountBill.vue",sourceRoot:""}])}});
//# sourceMappingURL=37.30a8fb38d13f6a95fc64.js.map