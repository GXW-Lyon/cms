webpackJsonp([51],{"6uwo":function(t,e,o){"use strict";function s(t){o("V34k")}Object.defineProperty(e,"__esModule",{value:!0});var a=o("e59c"),r=o("8lx0"),i=o("vSla"),c=s,n=i(a.a,r.a,!1,c,null,null);e.default=n.exports},"7rrL":function(t,e,o){e=t.exports=o("UTlt")(!0),e.push([t.i,"","",{version:3,sources:[],names:[],mappings:"",file:"customerProNew.vue",sourceRoot:""}])},"8lx0":function(t,e,o){"use strict";var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticClass:"page_create customerProNew"},[o("div",{staticClass:"menuNav"},[o("p",[o("i",{staticClass:"nav_index"}),t._l(t.menu_nav,function(e,s){return o("span",{key:s},[o("i",{staticClass:"el-icon-arrow-right"}),o("em",[t._v(t._s(e))])])})],2)]),t._v(" "),o("div",{staticClass:"page_d_title"},[o("i"),o("span",[t._v(t._s(t.pageTitle))])]),t._v(" "),o("div",{staticClass:"page_d_con"},[o("div",{staticClass:"page_d_con_left cpa_page_left",class:{page_d_con_left_widthAll:!t.isRightBox}},[o("div",{staticClass:"banner_part_line page_create_set_line"},[t._v("产品信息")]),t._v(" "),o("el-form",{ref:"form",attrs:{model:t.pro_from,"label-width":"125px"}},[o("el-form-item",{attrs:{label:"客户名称："}},[o("el-select",{staticClass:"f_select1",attrs:{filterable:"",placeholder:"请选择",disabled:t.dateStatus,filterable:""},on:{change:t.cusSelect},model:{value:t.pro_from.customerCode,callback:function(e){t.$set(t.pro_from,"customerCode",e)},expression:"pro_from.customerCode"}},t._l(t.customer_items.options,function(t,e){return o("el-option",{key:t.customerCode,attrs:{label:t.name,value:t.customerCode}})}))],1),t._v(" "),o("el-form-item",{staticStyle:{height:"auto"},attrs:{label:"产品名称："}},[o("el-radio-group",{staticClass:"f_radio2 f_radio",attrs:{disabled:t.dateStatus},model:{value:t.proStatus,callback:function(e){t.proStatus=e},expression:"proStatus"}},[o("el-radio",{attrs:{label:0}},[t._v("新产品")]),t._v(" "),o("el-radio",{attrs:{label:1}},[t._v("选择已有产品")])],1),t._v(" "),0==t.proStatus?o("el-input",{staticClass:"blockBox",attrs:{placeholder:"请输入产品名称",disabled:t.dateStatus},model:{value:t.pro_from.productName,callback:function(e){t.$set(t.pro_from,"productName",e)},expression:"pro_from.productName"}}):t._e(),t._v(" "),1==t.proStatus?o("el-select",{staticClass:"f_select1 blockBox",attrs:{placeholder:"请选择",disabled:t.dateStatus},on:{change:function(t){}},model:{value:t.pro_from.productCode,callback:function(e){t.$set(t.pro_from,"productCode",e)},expression:"pro_from.productCode"}},t._l(t.pro_items.options,function(t,e){return o("el-option",{key:t.id,attrs:{label:t.productName,value:t.customerProductCode}})})):t._e()],1),t._v(" "),o("el-form-item",{attrs:{label:"业务类型："}},[o("el-select",{staticClass:"f_select1",attrs:{placeholder:t.cooperativeMode_items.placeHolder},on:{change:function(t){}},model:{value:t.pro_from.cooperativeMode,callback:function(e){t.$set(t.pro_from,"cooperativeMode",e)},expression:"pro_from.cooperativeMode"}},t._l(t.cooperativeMode_items.options,function(t,e){return o("el-option",{key:t.id,attrs:{label:t.value,value:t.id}})}))],1),t._v(" "),o("el-form-item",{attrs:{label:"上游渠道号："}},[o("el-input",{attrs:{placeholder:"请输入上游渠道号"},model:{value:t.pro_from.productChannelCode,callback:function(e){t.$set(t.pro_from,"productChannelCode",e)},expression:"pro_from.productChannelCode"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"康远渠道号："}},[o("el-input",{attrs:{placeholder:"请输入康远渠道号"},model:{value:t.pro_from.kyProductChannelCode,callback:function(e){t.$set(t.pro_from,"kyProductChannelCode","string"==typeof e?e.trim():e)},expression:"pro_from.kyProductChannelCode"}})],1),t._v(" "),o("el-form-item",{staticStyle:{height:"auto"},attrs:{label:"填充渠道包："}},[o("el-radio-group",{staticClass:"f_radio2 f_radio",model:{value:t.channelPackstatus,callback:function(e){t.channelPackstatus=e},expression:"channelPackstatus"}},[o("el-radio",{attrs:{label:1}},[t._v("填充渠道链接")]),t._v(" "),o("el-radio",{attrs:{label:0}},[t._v("上传渠道包")])],1),t._v(" "),"1"==t.channelPackstatus?o("el-input",{staticClass:"blockBox",attrs:{placeholder:"请输入渠道链接"},model:{value:t.pro_from.packageLink,callback:function(e){t.$set(t.pro_from,"packageLink",e)},expression:"pro_from.packageLink"}}):t._e(),t._v(" "),"0"==t.channelPackstatus?o("el-upload",{staticClass:"upload-demo",attrs:{action:t.apiUrl.uploadApk,"with-credentials":!0,"on-success":t.handleSuccess,"on-remove":t.handleRemove,beforeUpload:t.beforeAvatarUpload,onError:t.uploadError,"file-list":t.fileList}},[o("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")]),t._v(" "),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传apk文件，且不超过2MB")])],1):t._e()],1),t._v(" "),o("el-form-item",{attrs:{label:"选择后台账号："}},[o("el-select",{staticClass:"f_select1",attrs:{placeholder:"请选择"},on:{change:function(t){}},model:{value:t.pro_from.backendAccountId,callback:function(e){t.$set(t.pro_from,"backendAccountId",e)},expression:"pro_from.backendAccountId"}},t._l(t.adminSysAccounts,function(t,e){return o("el-option",{key:t.id,attrs:{label:t.account,value:t.id}})}))],1),t._v(" "),o("el-form-item",{staticStyle:{height:"auto"},attrs:{label:"接入价："}},[t._l(t.pro_from.prices,function(e,s){return e.deleted?t._e():o("div",{key:e.id},[o("div",{staticClass:"block"},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},on:{change:function(e){t.dateChange(s)}},model:{value:e.date,callback:function(o){t.$set(e,"date",o)},expression:"item.date"}})],1),t._v(" "),o("el-input",{staticClass:"el_input_short",attrs:{placeholder:"请输入接入价"},on:{change:function(e){t.priceInputChange(s)}},model:{value:e.price,callback:function(o){t.$set(e,"price",o)},expression:"item.price"}}),t._v("\n                                元\n                                "),t.dateStatus?o("span",{staticClass:"r_span",staticStyle:{"font-size":"16px"},on:{click:function(e){t.deletePrice(s)}}},[t._v("删除")]):t._e(),t._v(" "),e.disexist?o("span",{staticStyle:{display:"inline-block","margin-left":"10px",color:"red"}},[t._v("* 已存在")]):t._e()],1)}),t._v(" "),o("el-button",{on:{click:t.addRow}},[t._v("添加一行")])],2),t._v(" "),o("el-form-item",{staticClass:"form_button"},[o("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确认")]),t._v(" "),o("el-button",{on:{click:function(e){t.go_back()}}},[t._v("返回")])],1)],1)],1),t._v(" "),t.isRightBox?o("div",{staticClass:"page_d_con_right cpa_page_right"},[o("div",{staticClass:"page_d_current page_create_current"},[o("div",{staticClass:"current_page_title create_page_title"},[t._v("操作历史记录")]),t._v(" "),o("div",{staticClass:"current_img"},t._l(4,function(e){return o("div",{key:e,staticClass:"text item"},[t._v("\n                                "+t._s("列表内容 "+e)+"\n                            ")])}))])]):t._e()])])])},a=[],r={render:s,staticRenderFns:a};e.a=r},V34k:function(t,e,o){var s=o("7rrL");"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);o("FIqI")("50d35065",s,!0,{})},e59c:function(t,e,o){"use strict";e.a={data:function(){return{pageTitle:"创建产品信息",menu_nav:["CPA数据管理","客户产品管理","创建产品信息"],isRightBox:!1,dateStatus:!1,uploadButStatus:!0,fileList:[],pro_from:{backendAccountId:"",cooperativeMode:"",customerCode:"",kyProductChannelCode:"",packageLink:"",prices:[{date:"",id:"",disable:!1,disexist:!1,price:""}],productChannelCode:"",productCode:"",productName:""},channelPackstatus:1,proStatus:1,customer_items:{placeHolder:"客户",options:[]},pro_items:{placeHolder:"产品",options:[]},cooperativeMode_items:{model_value:"",placeHolder:"业务类型",options:[]},adminSysAccounts:[],customerId:"",customerCode:""}},created:function(){this.customerSelect(),this.businessModel(),this.customerId=this.$route.query.customerId,""!=this.customerId&&(this.pageInfo(),this.pageTitle="编辑产品信息",this.dateStatus=!0)},methods:{customerSelect:function(){var t=this;this.$http({method:"get",url:this.apiUrl.customerSearch,params:{offset:1,limit:9999,val:""}}).then(function(e){if(200==e.status){var o=e.data;t.customer_items.options=o.items}}).catch(function(t){console.log(t)})},proInfo:function(){var t=this;this.$http({method:"get",url:this.apiUrl.customerProListLight,params:{customerCode:this.pro_from.customerCode}}).then(function(e){if(200==e.status){var o=e.data;t.pro_items.options=o.items,t.pro_from.productName=""}}).catch(function(t){console.log(t)})},adminSysInfo:function(){var t,e=this;this.pro_from.customerID?t=this.pro_from.customerID:this.customer_items.options.forEach(function(o,s){o.customerCode==e.pro_from.customerCode&&(t=o.id)}),this.$http({method:"get",url:this.apiUrl.customerGet,params:{id:t}}).then(function(t){if(200==t.status){var o=t.data;e.adminSysAccounts=o.adminSysAccounts,e.adminSysAccounts.map(function(t,o){""==t.account&&e.adminSysAccounts.splice(o,1)})}}).catch(function(t){console.log(t)})},businessModel:function(){var t=this;this.$http({method:"get",url:this.apiUrl.customerProListBiztype}).then(function(e){if(200==e.status){var o=e.data;t.cooperativeMode_items.options=o.lists}}).catch(function(t){console.log(t)})},pageInfo:function(){var t=this;this.$http({method:"get",url:this.apiUrl.customerProGet,params:{id:this.customerId}}).then(function(e){(e.status=200)&&(t.pro_from=e.data,0==t.pro_from.cooperativeMode&&(t.pro_from.cooperativeMode=""))}).catch(function(t){})},cusSelect:function(){this.proInfo(),this.adminSysInfo(),""==this.customerId&&(this.pro_from.productCode=this.pro_from.backendAccountId="")},onSubmit:function(){var t=this;delete this.pro_from.adminSysAccounts,""==this.customerId&&0==this.proStatus?delete this.pro_from.productCode:""==this.customerId&&1==this.proStatus&&delete this.pro_from.productName;var e=this.pro_from.prices,o=e.length,s=!1;if(""!=this.customerId&&this.customerId)for(var a=0;a<o;a++){if(!(""!=e[a].date&&""!=e[a].price&&e[a].date||e[a].deleted))return this.$message({type:"info",message:"接入价不能为空，请修改并重新提交"}),!1;e[a].disexist&&(s=!0)}else for(var r=0;r<o;r++)""!=e[r].date&&""!=e[r].price&&e[r].date?e[r].disexist&&(s=!0):(e.splice(r,1),r--,o=e.length);if(s)return this.$message({type:"info",message:"存在重复的接入价，请修改或删除并重新提交"}),!1;0==o&&this.addRow();var i=this.apiUrl.customerProNew;""!=this.customerId&&(i=this.apiUrl.customerProUpdate),console.log(this.pro_from),this.$http({method:"post",url:i,data:this.pro_from}).then(function(e){if(200==e.status){var o=e.data;o.id>=0?2==o.status?t.$message({type:"info",message:o.msg}):(t.$message({type:"success",message:"操作成功"}),t.go_back()):t.$message({type:"error",message:"操作失败"})}else t.$message({type:"error",message:"操作失败，请完善信息，并重新提交"})}).catch(function(e){t.$message({type:"error",message:"请完善信息，并重新提交"})})},go_back:function(){this.$router.back()},handleRemove:function(t,e){this.uploadButStatus=!0,this.fileList=[],this.pro_from.packageLink=""},handleSuccess:function(t,e,o){this.fileList.push({name:e.name,url:t.url}),1==t.status&&(this.pro_from.packageLink=t.url,this.uploadButStatus=!1)},uploadError:function(t,e,o){this.$message({type:"error",message:"上传失败，请重试"})},beforeAvatarUpload:function(t){if(!this.uploadButStatus)return this.$message({type:"info",message:"只能上传一个包，您可删除已选，重新上传"}),!1;if(this.fileList.length>=1)return!1;var e=t.name.split("."),o=e.length-1,s="apk"===e[o],a=t.size/1024/1024<2;return s||this.$message({type:"info",message:"上传渠道包只能是 apk 格式"}),a||this.$message({type:"info",message:"上传包大小不能超过 2MB"}),s&&a},dateChange:function(t){var e=this.pro_from.prices[t].date||"";this.pro_from.prices[t].date=""!=e&&"undefined"!=e&&void 0!==e?this.formatDateTime(new Date(e),"y-m-d"):"",this.priceInputChange(t)},addRow:function(){this.pro_from.prices.push({date:"",disable:!1,disexist:!1,deleted:!1,price:""})},deletePrice:function(t){var e=this.pro_from.prices,o=e.length,s=!1;if(""!=this.customerId&&this.customerId)for(var a=0;a<o;a++)e[a].disexist&&(s=!0);if(s)return this.$message({type:"info",message:"存在重复的接入价，请修改后再进行删除"}),!1;this.pro_from.prices[t].deleted=!0,this.pro_from.prices[t].disexist=!1},priceInputChange:function(t){var e=this.pro_from.prices,o=this.pro_from.prices[t];if(o.price&&o.date)try{e.forEach(function(e,s){s!=t&&e.date==o.date&&e.price&&!e.deleted?(o.disexist=!0,foreach.break=new Error("StopIteration")):s!=t&&e.date!=o.date&&e.price&&!e.deleted&&(o.disexist=!1)})}catch(t){if("foreach is not defined"===t.message)return;throw t}else e.forEach(function(t,o){if(t.disexist&&t.date&&t.price){var s=!0;e.forEach(function(e,a){o!=a&&t.date==e.date&&e.price&&(s=!1)}),s&&(t.disexist=!1)}else t.disexist=!1})}}}}});
//# sourceMappingURL=51.dd684e62843eb179dd86.js.map