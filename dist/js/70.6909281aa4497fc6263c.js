webpackJsonp([70],{"0RWR":function(e,t,l){t=e.exports=l("UTlt")(!0),t.push([e.i,"","",{version:3,sources:[],names:[],mappings:"",file:"channelAccountBill.vue",sourceRoot:""}])},"Pv+z":function(e,t,l){"use strict";function a(e){l("k/e9")}Object.defineProperty(t,"__esModule",{value:!0});var i=l("zVKg"),s=l("eHBc"),o=l("vSla"),n=a,r=o(i.a,s.a,!1,n,null,null);t.default=r.exports},eHBc:function(e,t,l){"use strict";var a=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[l("div",{staticClass:"info_flow_content customerAccountBill channelAccountBill",on:{click:e.bodyEvent}},[l("div",{staticClass:"menuNav"},[l("p",[l("i",{staticClass:"nav_index"}),e._l(e.menu_nav,function(t,a){return l("span",{key:a},[l("i",{staticClass:"el-icon-arrow-right"}),l("em",[e._v(e._s(t))])])})],2)]),e._v(" "),l("div",{staticClass:"info_ad_search"},[l("div",{staticClass:"info_a_s_content"},[l("div",{staticClass:"dateSelect"},[l("div",{staticClass:"block"},[l("span",{staticClass:"demonstration"},[e._v("选择日期")]),e._v(" "),l("el-date-picker",{attrs:{type:"daterange",align:"right",placeholder:"选择日期范围",format:"yyyy / MM / dd","picker-options":e.$store.state.pickerOptions2},on:{change:e.dateChange},model:{value:e.dateValue,callback:function(t){e.dateValue=t},expression:"dateValue"}})],1),e._v(" "),l("el-select",{staticClass:"con_select unBorderRadius selectMaxWidth",attrs:{placeholder:e.channel_items.placeHolder,filterable:""},on:{change:function(t){e.select("1",e.channel_items.model_value)}},model:{value:e.channel_items.model_value,callback:function(t){e.$set(e.channel_items,"model_value",t)},expression:"channel_items.model_value"}},e._l(e.channel_items.options,function(e){return l("el-option",{key:e.channelCode,attrs:{label:e.name,value:e.channelCode}})})),e._v(" "),l("el-select",{staticClass:"con_select unBorderRadius selectMaxWidth",attrs:{placeholder:e.pro_items.placeHolder,multiple:""},on:{change:function(t){e.select("2",e.proModelValue)}},model:{value:e.proModelValue,callback:function(t){e.proModelValue=t},expression:"proModelValue"}},[l("p",{staticStyle:{"font-size":"14px",padding:"8px 10px",position:"relative","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis",color:"#48576a",height:"36px","line-height":"1.5","box-sizing":"border-box",cursor:"pointer","-moz-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","-khtml-user-select":"none","user-select":"none"},on:{click:e.proSelectAll}},[e._v(e._s(e.proSelectAllValue))]),e._v(" "),e._l(e.pro_items.options,function(e){return l("el-option",{key:e.productCode,attrs:{label:e.productName,value:e.productCode}})})],2),e._v(" "),l("el-select",{staticClass:"con_select unBorderRadius selectMaxWidth",attrs:{disabled:e.multipleStatus,placeholder:e.channelPro_items.placeHolder,filterable:""},on:{change:function(t){e.select("3",e.channelPro_items.model_value)}},model:{value:e.channelPro_items.model_value,callback:function(t){e.$set(e.channelPro_items,"model_value",t)},expression:"channelPro_items.model_value"}},e._l(e.channelPro_items.options,function(e){return l("el-option",{key:e.customerProductCode,attrs:{label:e.productChannelCode,value:e.customerProductCode}})})),e._v(" "),l("el-button",{staticClass:"page_d_s_button",on:{click:e.pageInfo}},[e._v("查询")])],1),e._v(" "),l("div",{staticClass:"realTimeCitySearch"},[e._l(e.select_itemss,function(t,a){return l("el-select",{key:a,staticClass:"con_select",attrs:{placeholder:t.placeHolder},on:{change:function(e){}},model:{value:t.model_value,callback:function(l){e.$set(t,"model_value",l)},expression:"c.model_value"}},e._l(t.options,function(e){return l("el-option",{key:e.id,attrs:{label:e.val,value:e.id}})}))}),e._v(" "),l("el-select",{staticClass:"con_select unBorderRadius selectMaxWidth",attrs:{placeholder:e.channel_full_items.placeHolder,filterable:"",clearable:""},model:{value:e.channel_full_items.model_value,callback:function(t){e.$set(e.channel_full_items,"model_value",t)},expression:"channel_full_items.model_value"}},e._l(e.channel_full_items.options,function(e){return l("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),e._v(" "),l("el-button",{staticClass:"page_d_s_button",staticStyle:{float:"right",width:"150px!important"},on:{click:function(t){e.createBill("part")}}},[e._v("\n                          对账无误，生成结算单\n                      ")])],2)])]),e._v(" "),l("div",{staticClass:"info_ad_table"},[l("div",{staticClass:"page_d_title"},[l("i",{staticStyle:{visibility:"hidden"}}),l("span"),e._v(" "),l("div",{staticClass:"tableVisibleMenu"},[l("p",{staticClass:"visibleMenuBut",on:{click:function(t){e.changeCheckStatus(t)}}}),e._v(" "),e.visibleMenuSelectStatus?l("div",{staticClass:"visibleMenuSelect",on:{click:function(t){e.preventDefault(t)}}},[l("el-checkbox-group",{attrs:{min:1},on:{change:e.checkedChange},model:{value:e.checkedCities,callback:function(t){e.checkedCities=t},expression:"checkedCities"}},e._l(e.cities,function(t){return l("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t))])}))],1):e._e()])]),e._v(" "),l("div",{staticClass:"tableDetail"},[l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{"element-loading-text":"拼命加载中",data:e.tableData,border:"",stripe:""}},[e._l(e.table_column,function(t,a){return t.visible?l("el-table-column",{key:a,attrs:{fixed:t.fixed,sortable:t.sortable,prop:t.prop,label:t.label,"class-name":t.prop.split(".")[1],width:t.width}}):e._e()}),e._v(" "),l("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100","min-width":"100","class-name":"exitBut"},scopedSlots:e._u([{key:"default",fn:function(t){return["button"==t.row.validStatus?l("span",{staticClass:"r_span",on:{click:e.checkAllEvent}},[e._v(e._s(e.checkAll?"全选":"取消全选"))]):l("el-checkbox",{model:{value:t.row.validStatus,callback:function(l){e.$set(t.row,"validStatus",l)},expression:"scope.row.validStatus"}})]}}])})],2)],1)]),e._v(" "),e.billStatus?l("div",{staticClass:"bill",on:{click:function(e){e.stopPropagation()}}},[l("div",{staticClass:"bill_title"},[l("span",[e._v("对账单")]),e._v(" "),l("button",{on:{click:function(t){return t.stopPropagation(),e.exitBill(t)}}},[e._v("×")])]),e._v(" "),l("div",{staticClass:"bill_table"},[l("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableDataBill,border:"",stripe:""}},e._l(e.table_column_bill_title,function(t,a){return t.visible?l("el-table-column",{key:a,attrs:{fixed:t.fixed,sortable:t.sortable,prop:t.prop,label:t.label,width:""}}):e._e()}))],1),e._v(" "),l("div",{staticClass:"bill_table_detail"},[l("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableDataBillDetail,border:"",stripe:""}},e._l(e.table_column_bill_detail,function(t,a){return t.visible?l("el-table-column",{key:a,attrs:{fixed:t.fixed,sortable:t.sortable,prop:t.prop,label:t.label,width:""}}):e._e()}))],1)]):e._e(),e._v(" "),l("el-dialog",{attrs:{title:"输入备注：",visible:e.dialogVisible,size:"tiny"},on:{"update:visible":function(t){e.dialogVisible=t}}},[l("el-input",{staticStyle:{"margin-bottom":"15px"},attrs:{type:"textarea",placeholder:"请输入结算单备注（必填）"},model:{value:e.params.memo,callback:function(t){e.$set(e.params,"memo",t)},expression:"params.memo"}}),e._v("\n              核减金额："),l("el-input",{staticClass:"el_input_short",staticStyle:{width:"200px!important"},attrs:{disabled:!1,placeholder:"核减金额（选填）"},model:{value:e.params.price,callback:function(t){e.$set(e.params,"price",t)},expression:"params.price"}}),e._v("\n              元\n              "),l("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{staticStyle:{height:"auto"},attrs:{type:"primary"},on:{click:function(){e.dialogVisible=!1,e.params.memo=""}}},[e._v("取 消")]),e._v(" "),l("el-button",{staticStyle:{height:"auto"},attrs:{type:"primary"},on:{click:e.changePriceSub}},[e._v("确 定")])],1)],1)],1)])},i=[],s={render:a,staticRenderFns:i};t.a=s},"k/e9":function(e,t,l){var a=l("0RWR");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);l("FIqI")("2b81c671",a,!0,{})},zVKg:function(e,t,l){"use strict";var a=l("HzJ8"),i=l.n(a);t.a={data:function(){return{loading:!1,multipleStatus:!1,checked:!0,billStatus:!1,dialogVisible:!1,visibleMenuSelectStatus:!1,checkAll:!1,checkedCities:["日期","渠道名称","产品名称","上游渠道号","康远渠道号","单价","结算量","收入金额（元）"],cities:["日期","渠道名称","产品名称","上游渠道号","康远渠道号","单价","结算量","收入金额（元）"],table_column:[{fixed:!1,prop:"date",label:"日期",sortable:!0,visible:!0,width:200},{fixed:!1,prop:"channelName",label:"渠道名称",sortable:!1,visible:!0},{fixed:!1,prop:"productName",label:"产品名称",sortable:!1,visible:!0},{fixed:!1,prop:"productChannelCode",label:"上游渠道号",sortable:!1,visible:!0,width:280},{fixed:!1,prop:"kyChannelName",label:"康远渠道号",sortable:!1,visible:!0},{fixed:!1,prop:"amount",label:"结算量",sortable:!1,visible:!0},{fixed:!1,prop:"price",label:"单价",sortable:!1,visible:!0},{fixed:!1,prop:"revenue",label:"收入金额（元）",sortable:!1,visible:!0}],table_column_bill_detail:[{fixed:!1,prop:"dataTime",label:"日期",sortable:!0,visible:!0},{fixed:!1,prop:"productName",label:"产品名称",sortable:!1,visible:!0},{fixed:!1,prop:"productChannelCode",label:"上游渠道号",sortable:!1,visible:!0},{fixed:!1,prop:"channelName",label:"渠道名称",sortable:!1,visible:!0},{fixed:!1,prop:"channelProductCode",label:"产品包渠道代码",sortable:!1,visible:!0},{fixed:!1,prop:"cooperateMode",label:"合作模式",sortable:!1,visible:!0},{fixed:!1,prop:"ajustmentAct",label:"业务数据",sortable:!1,visible:!0},{fixed:!1,prop:"unitPrice",label:"单价",sortable:!1,visible:!0},{fixed:!1,prop:"gainings",label:"收入金额（元）",sortable:!1,visible:!0},{fixed:!1,prop:"upstreamSettlementStatus",label:"上游结算状态",sortable:!0,visible:!0},{fixed:!1,prop:"downstreamSettlementStatus",label:"下游结算状态",sortable:!0,visible:!0}],table_column_bill_title:[{fixed:!1,prop:"billNo",label:"结算单号",sortable:!1,visible:!0},{fixed:!1,prop:"billDate",label:"结算单日期",sortable:!1,visible:!0},{fixed:!1,prop:"customerName",label:"客户名称",sortable:!1,visible:!0},{fixed:!1,prop:"startDate",label:"账目周期开始日期",sortable:!1,visible:!0},{fixed:!1,prop:"endDate",label:"账目周期结束日期",sortable:!1,visible:!0},{fixed:!1,prop:"actualCost",label:"结算金额（元）",sortable:!1,visible:!0}],page:{sizes:[10,20,30,50,100,500],offset:1,limit:10,count:1e3,currentPage:1,landpageName:""},menu_nav:["CPA数据管理","渠道对账"],channel_items:{model_value:"",placeHolder:"渠道",options:[]},pro_items:{model_value:"",placeHolder:"产品",options:[]},proModelValue:[],channelPro_items:{model_value:"",placeHolder:"上游渠道号",options:[]},select_itemss:[{model_value:"",placeHolder:"结算主体",options:[{id:"Y1",val:"深圳康远互动科技有限公司"},{id:"Y2",val:"霍尔果斯康远互动网络科技有限公司"},{id:"Y3",val:"上海贝玩网络科技有限公司"},{id:"Y4",val:"深圳自由泰格互动科技有限公司"},{id:"Y5",val:"现金"},{id:"Y6",val:"北京康远互动网络科技有限公司"}]},{model_value:"",placeHolder:"结算模式",options:[{id:"3",val:"渠道结算"},{id:"4",val:"渠道预付"}]}],channel_full_items:{model_value:"",placeHolder:"渠道主体",options:[]},tableDataBill:[],tableDataBillDetail:[],tableData:[],dateValue:"",proSelectAllValue:"全部",params:{type:"",val:"",startDate:"",endDate:"",sessionId:"",memo:"",price:""},idList:[],isFirstEnter:!1}},activated:function(){this.$route.meta.isBack&&!this.isFirstEnter||this.channelSelect(),this.$route.meta.isBack=!1,this.isFirstEnter=!1},created:function(){this.isFirstEnter=!0},methods:{channelSelect:function(){var e=this;this.$http({method:"get",url:this.apiUrl.channelSearch,params:{offset:1,limit:9999,val:""}}).then(function(t){if(200==t.status){var l=t.data;e.channel_items.options=l.items,l.items.length>0&&(e.channel_items.model_value=l.items[0].channelCode)}}).catch(function(e){console.log(e)})},fullName:function(){var e=this;this.$http({method:"get",url:this.apiUrl.channelGetAlias,params:{code:this.channel_items.model_value}}).then(function(t){console.log(t),200==t.status&&(e.channel_full_items.options=t.data)}).catch(function(e){console.log(e)})},proInfo:function(){var e=this;this.$http({method:"get",url:this.apiUrl.channelProList,params:{channelCode:this.channel_items.model_value}}).then(function(t){if(200==t.status){var l=t.data;e.pro_items.options=l.items}}).catch(function(e){console.log(e)})},channelProInfo:function(){var e=this;this.proModelValue.length>0&&void 0!==this.proModelValue?this.$http({method:"get",url:this.apiUrl.channelProListPack,params:{channelCode:this.channel_items.model_value,productCode:this.proModelValue.join("|")}}).then(function(t){if(200==t.status){var l=t.data;e.channelPro_items.options=l.items}}).catch(function(e){console.log(e)}):(this.channelPro_items.model_value="",this.channelPro_items.options=[])},select:function(e,t){switch(this.params.type=e,this.params.val=t,e){case"1":this.proInfo(),this.fullName(),this.proModelValue=[],this.proSelectAllValue="全部";break;case"2":this.params.val=t.join("|"),t.length<=1?(this.multipleStatus=!1,this.channelProInfo(),this.channelPro_items.model_value=""):this.multipleStatus=!0}},pageInfo:function(){var e=this;if(""==this.params.startDate||""==this.params.endDate)return this.$message({type:"info",message:"请选择日期"}),!1;if(!this.proModelValue.length)return this.$message({type:"info",message:"请选择产品"}),!1;this.loading=!0;var t={type:"2",codeType:this.params.type,searchKey:this.params.val,channelCode:this.channel_items.model_value,sDataTime:this.params.startDate,eDataTime:this.params.endDate};this.$http({method:"get",url:this.apiUrl.billStatConsume,params:t}).then(function(t){if(console.log(t),e.loading=!1,t.status=200){e.params.sessionId=t.data.sessionId;var l=!0,a=!1,s=void 0;try{for(var o,n=i()(t.data.list);!(l=(o=n.next()).done);l=!0){o.value.validStatus=!0}}catch(e){a=!0,s=e}finally{try{!l&&n.return&&n.return()}finally{if(a)throw s}}t.data.list.unshift({date:"汇总",amount:t.data.summary.amount,revenue:t.data.summary.revenue,validStatus:"button"}),e.checkAll=!1,e.tableData=t.data.list}}).catch(function(t){e.loading=!1,e.tableData=[],e.params.sessionId="",e.$message({type:"error",message:t.response.data})})},createCusBill:function(){var e=this;this.$http({method:"get",url:this.apiUrl.createBill,params:{sessionid:this.params.sessionId,owner:this.select_itemss[0].model_value,myOwner:this.channel_full_items.model_value,billType:this.select_itemss[1].model_value,statItemIds:this.idList.join("|"),memo:this.params.memo,actualPrice:this.params.price||0}}).then(function(t){(t.status=200)&&(e.$message({type:"success",message:"生成成功!"}),e.tableData=[],e.params.sessionId="")}).catch(function(t){e.$message({type:"error",message:t.response.data})})},seeCusBill:function(e){var t=this;this.$http({method:"get",url:this.apiUrl.getChannelBill,params:{no:e}}).then(function(e){if(200==e.status){var l=e.data;t.tableDataBill=[],t.tableDataBill.push(l.bill),t.tableDataBillDetail=l.realdatas}}).catch(function(e){console.log(e)})},handleCurrentChange:function(e){this.page.offset=e,this.pageInfo()},handleSizeChange:function(e){this.page.limit=e,this.pageInfo()},checkedChange:function(){var e=!0,t=!1,l=void 0;try{for(var a,s=i()(this.table_column);!(e=(a=s.next()).done);e=!0){var o=a.value,n=this.checkedCities.indexOf(o.label);o.visible=n>=0}}catch(e){t=!0,l=e}finally{try{!e&&s.return&&s.return()}finally{if(t)throw l}}},changeCheckStatus:function(e){e.stopPropagation(),this.visibleMenuSelectStatus=!this.visibleMenuSelectStatus},exitBill:function(){this.billStatus=!1},bodyEvent:function(){this.visibleMenuSelectStatus=!1,this.billStatus=!1},preventDefault:function(e){e.stopPropagation()},exitEvent:function(){this.billStatus=!0},seeBill:function(e){this.seeCusBill(e),this.billStatus=!0},dateChange:function(){this.params.startDate=this.formatDateTime(this.dateValue[0],"y-m-d"),this.params.endDate=this.formatDateTime(this.dateValue[1],"y-m-d")},createBill:function(e){if(""==this.select_itemss[0].model_value)return this.$message({type:"info",message:"请选择结算主体"}),!1;if(""==this.select_itemss[1].model_value)return this.$message({type:"info",message:"请选择结算模式"}),!1;if("all"==e){if(0==this.proModelValue.length)return this.$message({type:"info",message:"请选择产品"}),!1;this.lockStatus()}else{this.idList=[];var t=!0,l=!1,a=void 0;try{for(var s,o=i()(this.tableData);!(t=(s=o.next()).done);t=!0){var n=s.value;n.validStatus&&"button"!=n.validStatus&&this.idList.push(n.id)}}catch(e){l=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(l)throw a}}0==this.idList.length?this.$message({type:"info",message:"请选择账单"}):this.dialogVisible=!0}},checkAllEvent:function(){var e=!0,t=!0,l=!1,a=void 0;try{for(var s,o=i()(this.tableData);!(t=(s=o.next()).done);t=!0){var n=s.value;"button"!=n.validStatus&&(n.validStatus=this.checkAll,e=!1)}}catch(e){l=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(l)throw a}}if(e)return!1;this.checkAll=!this.checkAll},lockStatus:function(){var e=this;this.$http({method:"get",url:this.apiUrl.lockStatus,params:{type:"2"}}).then(function(t){if(console.log(t),200==t.status){var l=t.data;0==l?e.$message({type:"info",message:"正在结算客户对账单中，请稍后重试"}):1==l&&e.quickCreateBill()}else e.$message({type:"error",message:"获取状态失败，请稍后重试"})}).catch(function(t){e.$message({type:"error",message:"获取状态失败，请稍后重试"})})},quickCreateBill:function(){var e=this;this.loading=!0,this.$http({method:"post",url:this.apiUrl.channelBillQuickCreate,data:{queryDate:this.params.startDate+":"+this.params.endDate,billOwner:this.select_itemss[0].model_value,billType:this.select_itemss[1].model_value,channelCode:this.channel_items.model_value,productCode:this.proModelValue.join("|"),customerProductCode:this.channelPro_items.model_value}}).then(function(t){e.loading=!1,1==t.data.status?(e.$message({type:"success",message:"一键快速生成渠道结算单成功!"}),e.pageInfo()):e.$message({type:"error",message:t.msg})}).catch(function(t){e.loading=!1,console.log(t),e.$message({type:"error",message:t.response.data})})},changePriceSub:function(){this.params.memo?(this.dialogVisible=!1,this.createCusBill()):this.$message({type:"info",message:"请输入备注"})},proSelectAll:function(){if("全部"==this.proSelectAllValue){var e=[];this.pro_items.options.forEach(function(t,l){e.push(t.productCode)}),this.proModelValue=e,this.proSelectAllValue="取消全部"}else this.proModelValue=[],this.proSelectAllValue="全部"}}}}});
//# sourceMappingURL=70.6909281aa4497fc6263c.js.map